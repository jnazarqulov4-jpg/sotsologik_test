<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title data-i18n="title">Harbiy Test</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#eef3fb; padding:20px; }
header { display:flex; align-items:center; padding:14px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
header img { width:46px; height:46px; border-radius:50%; object-fit:cover; }
header h2 { margin-left:12px; }
.lang-box { margin-left:auto; }
.lang-box button { margin-left:6px; padding:6px 10px; cursor:pointer; border-radius:6px; border:1px solid #ccc; background:#f2f2f2; }
.lang-box button.active { background:#1a73e8; color:#fff; border-color:transparent; }
.container { max-width:900px; margin:30px auto; padding:0 16px; }
.question { background:#fff; padding:18px; margin-bottom:12px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.06); }
label.option { display:block; padding:10px; border-radius:8px; margin-top:8px; border:1px solid #ddd; cursor:pointer; transition:0.2s; }
label.option:hover { background:#e0eaff; }
button.submit { background:#1a73e8; color:#fff; padding:12px 16px; border:none; border-radius:8px; cursor:pointer; font-size:16px; width:100%; margin-top:12px; }
</style>
</head>
<body>

<header>
  <img src="rasm/mho_logoo.jfif" alt="logo">
  <h2 data-i18n="header_title">Harbiy Test</h2>

  <div class="lang-box">
      <button type="button" data-lang="uz">UZ</button>
      <button type="button" data-lang="ru">RU</button>
      <button type="button" data-lang="en">EN</button>
  </div>
</header>

<div class="container" id="quiz"></div>

<script>
const dict = {
  uz: {
    title: "Harbiy Test",
    header_title: "Harbiy Test",
    submit_btn: "Boshlash va Yuborish",
    must_select: i => `${i}-savolni belgilang!`,
    q: [
      "O‘zbekiston Qurolli Kuchlari qachon tashkil topgan?",
      "Harbiy xizmatda 'komandir' kimni bildiradi?",
      "Harbiy signal flagi nimaga xizmat qiladi?",
      "Harbiy libosning asosiy rangi nima?",
      "Qurolli kuchlarning asosiy maqsadi nima?",
      "Harbiy mashq nimaga xizmat qiladi?",
      "Harbiy xizmatda eng muhim fazilat nima?",
      "O‘zbekiston Qurolli Kuchlarida qaysi xizmat turi mavjud?",
      "Harbiy xizmatga chaqirilgan yosh chegarasi?",
      "Harbiy tayyorgarlikda fizika va sportning ahamiyati?"
    ],
    opt: [
      ["1991","1992","1990","1989"],
      ["Askarlardan biri","Boshliq/offitser","Vatan himoyachisi","Dala bo‘yicha mas’ul shaxs"],
      ["Xabar uzatish","Shaxsiy bezak","Yig‘in tashkil etish","Harbiy mashqlar"],
      ["Yashil","Qora","Ko‘k","Qizil"],
      ["Davlat himoyasi","Futbol o‘ynash","Tadbirkorlik","Turizm"],
      ["Harbiy tayyorgarlik","Shaxsiy xobbi","Sarguzasht","Madaniy tadbir"],
      ["Vatanparvarlik","Do‘stlik","Sabrlilik","Tezlik"],
      ["Quruqlik, Havo, Dengiz","Oziq-ovqat","Transport","Ma’muriyat"],
      ["18-27","18-35","20-30","21-32"],
      ["Juda muhim","O‘rtacha","Kam ahamiyatli","Hech ahamiyati yo‘q"]
    ]
  },
  ru: {
    title: "Военный тест",
    header_title: "Военный тест",
    submit_btn: "Начать и отправить",
    must_select: i => `Выберите ответ для ${i}-вопроса!`,
    q: [
      "Когда были созданы Вооруженные силы Узбекистана?",
      "Кто такой 'командир' в военной службе?",
      "Для чего служит военный сигнальный флаг?",
      "Какой основной цвет военной формы?",
      "Основная цель Вооруженных сил?",
      "Для чего проводятся военные учения?",
      "Самое важное качество в военной службе?",
      "Какие виды службы существуют в Вооруженных силах Узбекистана?",
      "Возрастной предел призыва на военную службу?",
      "Важность физики и спорта в военной подготовке?"
    ],
    opt: [
      ["1991","1992","1990","1989"],
      ["Один из солдат","Начальник/офицер","Защитник Родины","Ответственный на поле"],
      ["Передача сообщений","Личная декорация","Организация сборов","Военные упражнения"],
      ["Зеленый","Черный","Синий","Красный"],
      ["Защита государства","Игра в футбол","Бизнес","Туризм"],
      ["Военная подготовка","Хобби","Приключение","Культурное мероприятие"],
      ["Патриотизм","Дружба","Терпение","Скорость"],
      ["Сухопутные, Воздушные, Морские","Питание","Транспорт","Администрация"],
      ["18-27","18-35","20-30","21-32"],
      ["Очень важно","Средне","Маловажно","Не имеет значения"]
    ]
  },
  en: {
    title: "Military Test",
    header_title: "Military Test",
    submit_btn: "Start and Submit",
    must_select: i => `Select an answer for question ${i}!`,
    q: [
      "When were the Armed Forces of Uzbekistan established?",
      "Who is a 'commander' in military service?",
      "What is the military signal flag used for?",
      "What is the main color of military uniform?",
      "Main purpose of the Armed Forces?",
      "What are military exercises for?",
      "Most important quality in military service?",
      "Types of service in Uzbekistan Armed Forces?",
      "Age limit for military conscription?",
      "Importance of physics and sports in military training?"
    ],
    opt: [
      ["1991","1992","1990","1989"],
      ["One of the soldiers","Leader/officer","Defender of the homeland","Field responsible person"],
      ["Message transmission","Personal decoration","Organizing gatherings","Military drills"],
      ["Green","Black","Blue","Red"],
      ["State defense","Playing football","Entrepreneurship","Tourism"],
      ["Military training","Hobby","Adventure","Cultural event"],
      ["Patriotism","Friendship","Patience","Speed"],
      ["Land, Air, Sea","Food","Transport","Administration"],
      ["18-27","18-35","20-30","21-32"],
      ["Very important","Average","Less important","No importance"]
    ]
  }
};

window.setLang = function(selectedLang){
  try { localStorage.setItem('lang', selectedLang); } catch(e) {}
  render();
};

let lang = localStorage.getItem('lang') || 'uz';

function render(){
  lang = localStorage.getItem('lang') || lang || 'uz';
  const D = dict[lang] || dict.uz;

  const titleEl = document.querySelector('title[data-i18n]');
  if(titleEl) titleEl.innerText = D.title;
  document.title = D.title;
  const hdr = document.querySelector('[data-i18n="header_title"]');
  if(hdr) hdr.innerText = D.header_title;

  document.querySelectorAll('.lang-box button').forEach(btn=>{
    if(btn.dataset.lang === lang) btn.classList.add('active');
    else btn.classList.remove('active');
  });

  const quiz = document.getElementById('quiz');
  quiz.innerHTML = '';

  D.q.forEach((qText, idx) => {
    const box = document.createElement('div');
    box.className = 'question';
    box.innerHTML = `<h4>${idx+1}. ${qText}</h4>`;

    (D.opt[idx] || []).forEach(opt => {
      const lbl = document.createElement('label');
      lbl.className = 'option';
      const safeVal = String(opt).replace(/"/g, '&quot;');
      lbl.innerHTML = `<input type="radio" name="q${idx}" value="${safeVal}"> ${opt}`;
      box.appendChild(lbl);
    });

    quiz.appendChild(box);
  });

  const btn = document.createElement('button');
  btn.className = 'submit';
  btn.type = 'button';
  btn.innerText = D.submit_btn;
  btn.onclick = submitForm;
  quiz.appendChild(btn);
}

document.addEventListener('DOMContentLoaded', ()=> {
  document.querySelectorAll('.lang-box button').forEach(b=>{
    const l = b.getAttribute('data-lang');
    b.dataset.lang = l;
    b.addEventListener('click', ()=> {
      window.setLang(l);
    });
  });
  render();
});

function submitForm(){
  const D = dict[lang];
  let currentUserStr = localStorage.getItem('current_user');
  if(!currentUserStr){
    alert(D && D.must_select ? (D.alerts?.login || 'Iltimos tizimga kiring') : 'Iltimos tizimga kiring');
    location.href='kirish.html';
    return;
  }
  let currentUser;
  try{ currentUser = JSON.parse(currentUserStr); }catch(e){
    alert(D && D.alerts ? (D.alerts.invalid || 'Tizimdagi ma’lumotlar noto‘g‘ri!') : 'Tizimdagi ma’lumotlar noto‘g‘ri!');
    location.href='kirish.html';
    return;
  }

  const answers = [];
  const total = (dict[lang].q || dict.uz.q).length;
  for(let i=0;i<total;i++){
    const sel = document.querySelector(`input[name='q${i}']:checked`);
    if(!sel){
      alert((i+1) + (dict[lang].must_select ? dict[lang].must_select(i+1).replace(`${i+1}-`, '-') : '-savolni belgilang!'));
      return;
    }
    answers.push(sel.value);
  }

  const results = JSON.parse(localStorage.getItem('results') || '[]');
  results.push({
    login: currentUser.login,
    ism: currentUser.ism,
    fam: currentUser.fam,
    vil: currentUser.vil || '',
    test: 'Harbiy',
    answers: answers,
    ts: new Date().toISOString()
  });
  localStorage.setItem('results', JSON.stringify(results));

  alert(dict[lang].alerts?.saved || 'Test muvaffaqiyatli saqlandi!');
  location.href = 'test.html';
}
</script>

</body>
</html>
