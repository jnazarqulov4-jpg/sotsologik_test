<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title data-i18n="title">Ruhiy Test</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#eef3fb; padding:20px; }
header { display:flex; align-items:center; padding:14px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.08); }
header img { width:46px; height:46px; border-radius:50%; object-fit:cover; }
header h2 { margin-left:12px; }
.lang-box { margin-left:auto; }
.lang-box button { margin-left:6px; padding:6px 10px; cursor:pointer; border-radius:6px; border:1px solid #ccc; background:#f2f2f2; }
.lang-box button.active { background:#1a73e8; color:#fff; border-color:transparent; }
.container { max-width:900px; margin:30px auto; padding:0 16px; }
.question { background:#fff; padding:18px; margin-bottom:12px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.06); }
label.option { display:block; padding:10px; border-radius:8px; margin-top:8px; border:1px solid #ddd; cursor:pointer; transition:0.2s; }
label.option:hover { background:#e0eaff; }
button.submit { background:#1a73e8; color:#fff; padding:12px 16px; border:none; border-radius:8px; cursor:pointer; font-size:16px; width:100%; margin-top:12px; }
</style>
</head>
<body>

<header>
  <img src="rasm/AdobeStock_1556054810_Preview.jpeg" alt="logo">
  <h2 data-i18n="header_title">Ruhiy Test</h2>

  <div class="lang-box">
      <button type="button" data-lang="uz">UZ</button>
      <button type="button" data-lang="ru">RU</button>
      <button type="button" data-lang="en">EN</button>
  </div>
</header>

<div class="container" id="quiz"></div>

<script>
const dict = {
  uz: {
    title: "Ruhiy Test",
    header_title: "Ruhiy Test",
    submit_btn: "Boshlash va Yuborish",
    must_select: i => `${i}-savolni belgilang!`,
    q: [
      "Siz hozir qanday kayfiyatdasiz?",
      "Oxirgi haftada qancha vaqt stress his qildingiz?",
      "Siz uyqudan qancha vaqt olasiz?",
      "Oxirgi oyning davomida ruhiy quvvatingiz qanday edi?",
      "Siz o‘zingizni ijtimoiy jihatdan faol his qilasizmi?",
      "Siz o‘zingizni tez-tez charchagan his qilasizmi?",
      "Ruhiy holatingizni yaxshilash uchun nimalar qilasiz?",
      "Do‘stlaringiz va oilangiz bilan munosabatlaringiz qanday?",
      "Siz ko‘p vaqtni yolg‘izlikda o‘tkazasizmi?",
      "Stress va tashvish darajangizni baholang",
      "Sizni eng ko‘p bezovta qiladigan omil nima?",
      "Sizning ijobiy kayfiyatingizni oshirish uchun nima kerak?",
      "Siz ruhiy yordam so‘rashingiz kerak deb his qilasizmi?",
      "Siz o‘zingizni hozirgi paytda qanchalik baxtli his qilasiz?"
    ],
    opt: [
      ["Juda yaxshi","Yaxshi","O‘rtacha","Yomon"],
      ["Hech qachon","Kamdan-kam","Ba’zan","Ko‘p"],
      ["4 soatdan kam","4-6 soat","6-8 soat","8 soatdan ko‘p"],
      ["Juda yuqori","Yaxshi","O‘rtacha","Past"],
      ["Ha","Ba’zan","Yo‘q"],
      ["Hech qachon","Kamdan-kam","Ba’zan","Tez-tez"],
      ["Mashq qilish","Do‘stlar bilan uchrashish","Kitob o‘qish","Meditatsiya"],
      ["Juda yaxshi","Yaxshi","O‘rtacha","Yomon"],
      ["Ha","Ba’zan","Yo‘q"],
      ["Juda yuqori","Yuqori","O‘rtacha","Past"],
      ["Ish, moliya, oilaviy","Sog‘liq, uyqu","Ijtimoiy munosabatlar","Boshqa"],
      ["Dam olish, sport","O‘qish, o‘rganish","Ijtimoiy faoliyat","Do‘stlar bilan uchrashish"],
      ["Ha, muntazam","Ba’zan","Yo‘q"],
      ["Juda baxtli","Baxtli","O‘rtacha","Baxtsiz"]
    ]
  },
  ru: {
    title: "Психологический тест",
    header_title: "Психологический тест",
    submit_btn: "Начать и отправить",
    must_select: i => `Выберите ответ для ${i}-вопроса!`,
    q: [
      "Какое у вас настроение сейчас?",
      "Сколько времени за последнюю неделю вы испытывали стресс?",
      "Сколько вы спите?",
      "Как была ваша энергия в течение последнего месяца?",
      "Чувствуете ли вы себя социально активным?",
      "Часто ли вы чувствуете усталость?",
      "Что вы делаете для улучшения своего психического состояния?",
      "Каковы ваши отношения с друзьями и семьёй?",
      "Проводите ли вы много времени в одиночестве?",
      "Оцените уровень стресса и тревоги",
      "Что вас больше всего беспокоит?",
      "Что необходимо для повышения вашего положительного настроя?",
      "Думаете ли вы, что вам нужна психологическая помощь?",
      "Насколько вы счастливы в данный момент?"
    ],
    opt: [
      ["Очень хорошо","Хорошо","Средне","Плохо"],
      ["Никогда","Редко","Иногда","Часто"],
      ["Менее 4 часов","4-6 часов","6-8 часов","Более 8 часов"],
      ["Очень высокий","Хорошо","Средне","Низко"],
      ["Да","Иногда","Нет"],
      ["Никогда","Редко","Иногда","Часто"],
      ["Физические упражнения","Встречи с друзьями","Чтение","Медитация"],
      ["Очень хорошо","Хорошо","Средне","Плохо"],
      ["Да","Иногда","Нет"],
      ["Очень высокий","Высокий","Средний","Низкий"],
      ["Работа, финансы, семья","Здоровье, сон","Социальные отношения","Другое"],
      ["Отдых, спорт","Учёба, обучение","Социальная активность","Встречи с друзьями"],
      ["Да, регулярно","Иногда","Нет"],
      ["Очень счастлив","Счастлив","Средне","Несчастлив"]
    ]
  },
  en: {
    title: "Psychological Test",
    header_title: "Psychological Test",
    submit_btn: "Start and Submit",
    must_select: i => `Select an answer for question ${i}!`,
    q: [
      "How is your mood right now?",
      "How often did you feel stressed last week?",
      "How much sleep do you get?",
      "How was your energy during the past month?",
      "Do you feel socially active?",
      "Do you often feel tired?",
      "What do you do to improve your mental state?",
      "How are your relationships with friends and family?",
      "Do you spend a lot of time alone?",
      "Rate your stress and anxiety levels",
      "What bothers you the most?",
      "What is needed to increase your positive mood?",
      "Do you feel you need psychological help?",
      "How happy do you feel right now?"
    ],
    opt: [
      ["Very good","Good","Average","Bad"],
      ["Never","Rarely","Sometimes","Often"],
      ["Less than 4 hours","4-6 hours","6-8 hours","More than 8 hours"],
      ["Very high","Good","Average","Low"],
      ["Yes","Sometimes","No"],
      ["Never","Rarely","Sometimes","Often"],
      ["Exercise","Meeting friends","Reading","Meditation"],
      ["Very good","Good","Average","Bad"],
      ["Yes","Sometimes","No"],
      ["Very high","High","Average","Low"],
      ["Work, finance, family","Health, sleep","Social relations","Other"],
      ["Rest, sport","Study, learning","Social activity","Meeting friends"],
      ["Yes, regularly","Sometimes","No"],
      ["Very happy","Happy","Average","Unhappy"]
    ]
  }
};

window.setLang = function(selectedLang){
  try { localStorage.setItem('lang', selectedLang); } catch(e) {}
  render();
};

let lang = localStorage.getItem('lang') || 'uz';

function render(){
  lang = localStorage.getItem('lang') || lang || 'uz';
  const D = dict[lang] || dict.uz;

  const titleEl = document.querySelector('title[data-i18n]');
  if(titleEl) titleEl.innerText = D.title;
  document.title = D.title;
  const hdr = document.querySelector('[data-i18n="header_title"]');
  if(hdr) hdr.innerText = D.header_title;

  document.querySelectorAll('.lang-box button').forEach(btn=>{
    if(btn.dataset.lang === lang) btn.classList.add('active');
    else btn.classList.remove('active');
  });

  const quiz = document.getElementById('quiz');
  quiz.innerHTML = '';

  D.q.forEach((qText, idx) => {
    const box = document.createElement('div');
    box.className = 'question';
    box.innerHTML = `<h4>${idx+1}. ${qText}</h4>`;
    (D.opt[idx] || []).forEach(opt => {
      const lbl = document.createElement('label');
      lbl.className = 'option';
      const safeVal = String(opt).replace(/"/g, '&quot;');
      lbl.innerHTML = `<input type="radio" name="q${idx}" value="${safeVal}"> ${opt}`;
      box.appendChild(lbl);
    });
    quiz.appendChild(box);
  });

  const btn = document.createElement('button');
  btn.className = 'submit';
  btn.type = 'button';
  btn.innerText = D.submit_btn;
  btn.onclick = submitForm;
  quiz.appendChild(btn);
}

document.addEventListener('DOMContentLoaded', ()=> {
  document.querySelectorAll('.lang-box button').forEach(b=>{
    const l = b.getAttribute('data-lang');
    b.dataset.lang = l;
    b.addEventListener('click', ()=> {
      window.setLang(l);
    });
  });
  render();
});

function submitForm(){
  const D = dict[lang];
  let currentUserStr = localStorage.getItem('current_user');
  if(!currentUserStr){
    alert(D && D.must_select ? (D.alerts?.login || 'Iltimos tizimga kiring') : 'Iltimos tizimga kiring');
    location.href='kirish.html';
    return;
  }
  let currentUser;
  try{ currentUser = JSON.parse(currentUserStr); }catch(e){
    alert(D && D.alerts ? (D.alerts.invalid || 'Tizimdagi ma’lumotlar noto‘g‘ri!') : 'Tizimdagi ma’lumotlar noto‘g‘ri!');
    location.href='kirish.html';
    return;
  }

  const answers = [];
  const total = (dict[lang].q || dict.uz.q).length;
  for(let i=0;i<total;i++){
    const sel = document.querySelector(`input[name='q${i}']:checked`);
    if(!sel){
      alert((i+1) + (dict[lang].must_select ? dict[lang].must_select(i+1).replace(`${i+1}-`, '-') : '-savolni belgilang!'));
      return;
    }
    answers.push(sel.value);
  }

  const results = JSON.parse(localStorage.getItem('results') || '[]');
  results.push({
    login: currentUser.login,
    ism: currentUser.ism,
    fam: currentUser.fam,
    vil: currentUser.vil || '',
    test: 'Ruhiy',
    answers: answers,
    ts: new Date().toISOString()
  });
  localStorage.setItem('results', JSON.stringify(results));

  alert(dict[lang].alerts?.saved || 'Test muvaffaqiyatli saqlandi!');
  location.href = 'test.html';
}
</script>

</body>
</html>
